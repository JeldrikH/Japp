<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Problem Solving Inventory (PSI)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2em;
    }

    h2 {
      color: #333;
    }

    .question {
      margin-bottom: 1.5em;
    }

    label {
      display: block;
      margin-bottom: 0.5em;
    }

    .scale-option {
      margin-right: 1em;
    }

    button {
      padding: 0.5em 1em;
      font-size: 1em;
      margin-top: 1em;
    }

    .hidden {
      display: none;
    }
  </style>
</head>

<body>
  <h2>Problem Solving Inventory (PSI) - Self Assessment</h2>
  <form id="psiForm">
    <!-- Questions will be inserted here by JavaScript -->
  </form>
  <button id="backButton" class="hidden" onclick="showPreviousQuestions()">Back</button>
  <button id="nextButton" onclick="showNextQuestions()">Next</button>
  <button id="submitButton" class="hidden" onclick="submitForm()">Submit</button>

  <script type="module">
    import QuestionaireDataManager from "../scripts/questionaireDataManager.js";
    const questions = [
      "When a solution to a problem has failed, I do not examine why it didn’t work.",
      "When I am confronted with a complex problem, I don’t take the time to develop a strategy for collecting information that will help define the nature of the problem.",
      "When my first efforts to solve a problem fail, I become uneasy about my ability to handle the situation.",
      "After I solve a problem, I do not analyze what went right and what went wrong.",
      "I am usually able to think of creative and effective alternatives to my problems.",
      "After following a course of action to solve a problem, I compare the actual outcome with the one I had anticipated.",
      "When I have a problem, I think of as many possible ways to handle it as I can until I can’t come up with any more ideas.",
      "When confronted with a problem, I consistently examine my feelings to find out what is going on in a problem situation.",
      "When confused about a problem, I don’t clarify vague ideas or feeling by thinking of them in concrete terms.",
      "I have the ability to solve most problems even though initially no solution is immediately apparent.",
      "Many of the problems I face are too complex for me to solve.",
      "When solving a problem, I make decisions that I am happy with later.",
      "When confronted with a problem, I tend to do the first thing that I can think of to solve it.",
      "Sometimes I do not stop and take time to deal with my problems, but just kind of muddle ahead.",
      "When considering solutions to a problem, I do not take the time to assess the potential success of each alternative.",
      "When confronted with a problem, I stop and think about it before deciding on a next step.",
      "I generally act on the first idea that comes to mind in solving a problem.",
      "When making a decision, I compare alternatives and weigh the consequences of one against the other.",
      "When I make plans to solve a problem, I am almost certain that I can make them work.",
      "I try to predict the result of a particular course of action.",
      "When I try to think of possible solutions to a problem, I do not come up with very many alternatives.",
      "When trying to solve a problem, one strategy I often use is to think of past problems that have been similar.",
      "Given enough time and effort, I believe I can solve most problems that confront me.",
      "When faced with a novel situation, I have confidence that I can handle problems that may arise.",
      "Even though I work on a problem, sometimes I feel like I’m groping or wandering and not getting down to the real issue.",
      "I make snap judgements and later regret them.",
      "I trust my ability to solve new and difficult problems.",
      "I use a systematic method to compare alternatives and make decisions.",
      "When thinking of ways to handle a problem, I seldom combine ideas from various alternatives to arrive at a workable solution.",
      "When faced with a problem, I seldom assess the external forces that may be contributing to the problem.",
      "When confronted with a problem, I usually first survey the situation to determine the relevant information.",
      "There are times when I become so emotionally charged that I can no longer see the alternatives for solving a particular problem.",
      "After making a decision, the actual outcome is usually similar to what I had anticipated.",
      "When confronted with a problem, I am unsure of whether I can handle the situation.",
      "When I become aware of a problem, one of the first things I do is try to find out exactly what the problem is."
    ];

    const subscales = [
      "AAS", "AAS", "PSC", "AAS", "PC", "PC", "PC", "PC", "Unbekannt", "PSC",
      "PC", "PSC", "AAS", "AAS", "AAS", "PC", "AAS", "PC", "PSC", "PC",
      "PC", "PC", "PSC", "PSC", "AAS", "AAS", "PSC", "PC", "PC", "PC",
      "PC", "PC", "PSC", "PSC", "PC"
    ];

    const scaleLabels = [
      "1 - Strongly Agree",
      "2 - Moderately Agree",
      "3 - Slightly Agree",
      "4 - Slightly Disagree",
      "5 - Moderately Disagree",
      "6 - Strongly Disagree"
    ];

    const form = document.getElementById("psiForm");
    const questionaireDataManager = new QuestionaireDataManager(); // Create an instance of QuestionaireDataManager
    questionaireDataManager.setType("PSI - Problem Solving Inventory"); // Set the type of the questionnaire

    let currentQuestionIndex = 0; // Tracks the current set of questions
    const questionsPerPage = 5; // Number of questions to show per page
    const userAnswers = {}; // Object to store user answers

    // Function to render a set of questions
    function renderQuestions(startIndex) {
      form.innerHTML = ""; // Clear the form
      const endIndex = Math.min(startIndex + questionsPerPage, questions.length);

      for (let i = startIndex; i < endIndex; i++) {
        const div = document.createElement("div");
        div.className = "question";

        const label = document.createElement("label");
        label.textContent = `${i + 1}. [${subscales[i]}] ${questions[i]}`;
        div.appendChild(label);

        scaleLabels.forEach((scaleText, value) => {
          const radio = document.createElement("input");
          radio.type = "radio";
          radio.name = `q${i + 1}`;
          radio.value = value + 1;
          radio.required = true;
          radio.className = "scale-option";

          // Pre-fill the radio button if the user has already answered this question
          if (userAnswers[`q${i + 1}`] === String(value + 1)) {
            radio.checked = true;
          }
          const span = document.createElement("span");
          span.textContent = scaleText;
          span.style.marginRight = "10px";

          div.appendChild(radio);
          div.appendChild(span);
        });

        form.appendChild(div);
      }
    }

    // Show the first set of questions
    renderQuestions(currentQuestionIndex);

    // Function to show the previous set of questions
    window.showPreviousQuestions = function () {
      const data = new FormData(form);
      for (let i = currentQuestionIndex; i < currentQuestionIndex + questionsPerPage; i++) {
        if (i >= questions.length) break;
        const answer = data.get(`q${i + 1}`);
        if (answer) {
          userAnswers[`q${i + 1}`] = answer; // Save the answer
        }
      }
      // Move to the previous set of questions
      currentQuestionIndex -= questionsPerPage;

      // Ensure the index doesn't go below 0
      if (currentQuestionIndex < 0) {
        currentQuestionIndex = 0;
      }

      // Render the previous set of questions
      renderQuestions(currentQuestionIndex);

      // Update button visibility
      if (currentQuestionIndex === 0) {
        document.getElementById("backButton").classList.add("hidden"); // Hide "Back" button on the first set
      }
      document.getElementById("nextButton").classList.remove("hidden"); // Show "Next" button
      document.getElementById("submitButton").classList.add("hidden"); // Hide "Submit" button
    };

    // Function to show the next set of questions
    window.showNextQuestions = function () {
      const data = new FormData(form);
      let allAnswered = true;

      // Validate that all questions on the current page are answered
      for (let i = currentQuestionIndex; i < currentQuestionIndex + questionsPerPage; i++) {
        if (i >= questions.length) break;
        const answer = data.get(`q${i + 1}`);
        if (!answer) {
          allAnswered = false;
          break;
        } else {
          userAnswers[`q${i + 1}`] = answer; // Save the answer
        }
      }

      if (!allAnswered) {
        alert("Please answer all questions before proceeding.");
        return;
      }

      // Move to the next set of questions
      currentQuestionIndex += questionsPerPage;

      if (currentQuestionIndex >= questions.length) {
        // If no more questions, show the submit button and hide the next button
        document.getElementById("nextButton").classList.add("hidden");
        document.getElementById("submitButton").classList.remove("hidden");
      } else {
        // Render the next set of questions
        renderQuestions(currentQuestionIndex);
      }

      // Show the "Back" button after the first set
      if (currentQuestionIndex > 0) {
        document.getElementById("backButton").classList.remove("hidden");
      }
    };

    // Function to submit the form
    window.submitForm = function () {
      // Iterate over the userAnswers object
      for (const [questionKey, answer] of Object.entries(userAnswers)) {
        // Extract the question index from the key (e.g., "q1" -> 1)
        const questionIndex = parseInt(questionKey.slice(1), 10) - 1;

        // Add data to QuestionaireDataManager
        questionaireDataManager.addQuestionaireData(
          parseInt(answer, 10), // Add answer as a number
          subscales[questionIndex], // Add subscale name
          questionIndex + 1 // Add question index (1-based)
        );
      }
      // Save and log the results
      questionaireDataManager.save();
      console.log("Questionnaire Data:", questionaireDataManager.getData());
      alert("Thank you! Your responses have been recorded.");
      window.location.href = '../end.html'; // Redirect to the end page
    };
    /*
    // Dynamically generate the questions
    questions.forEach((text, index) => {
      const div = document.createElement("div");
      div.className = "question";

      const label = document.createElement("label");
      label.textContent = `${index + 1}. [${subscales[index]}] ${text}`;
      div.appendChild(label);

      scaleLabels.forEach((scaleText, value) => {
        const radio = document.createElement("input");
        radio.type = "radio";
        radio.name = `q${index + 1}`;
        radio.value = value + 1;
        radio.required = true;
        radio.className = "scale-option";

        const span = document.createElement("span");
        span.textContent = scaleText;
        span.style.marginRight = "10px";

        div.appendChild(radio);
        div.appendChild(span);
      });

      form.appendChild(div);
    });
    */

    /*
    window.submitForm = function () {
      const data = new FormData(form);
      let allAnswered = true;

      questions.forEach((_, index) => {
        const answer = data.get(`q${index + 1}`);
        if (!answer) {
          allAnswered = false; // If any question is unanswered, set flag to false
        } else {

          // Add data to QuestionaireDataManager
          questionaireDataManager.addQuestionaireData(
            parseInt(answer, 10), // Add answer as a number
            subscales[index], // Add subscale name
            index + 1 // Add question index
          );

        }
      });

      if (!allAnswered) {
        alert("Please answer all questions before submitting.");
        return; // Stop submission if not all questions are answered
      }

      // Save and log the results
      questionaireDataManager.save();
      console.log("Questionnaire Data:", questionaireDataManager.getData());
      alert("Thank you! Your responses have been recorded.");
      window.location.href = '../end.html'; // Redirect to the end page 
    }
      */
  </script>
</body>

</html>