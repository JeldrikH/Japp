<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Problem Solving Inventory (PSI)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 1rem;
      background-color: #f9f9f9;
      color: #333;
      box-sizing: border-box;
    }

    h2 {
      color: #007BFF;
      text-align: center;
      margin-bottom: 1.5em;
      font-size: 1.5rem;
    }

    .question {
      background-color: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 1em;
      margin-bottom: 1.5em;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }

    label {
      display: block;
      font-size: 1rem;
      margin-top: 0.2em;
      color: #555;
    }

    .scale-options {
      display: flex;
      flex-direction: column;
      margin-top: 0.5em;
    }

    .scale-option {
      display: flex;
      align-items: center;
      gap: 0.5em;
    }

    input[type="radio"] {
      accent-color: #007BFF;
      width: 20px;
      height: 20px;
      cursor: pointer;
    }

    button {
      display: inline-block;
      padding: 0.75em 1.5em;
      font-size: 1rem;
      background-color: #007BFF;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin: 0.5 auto;
      transition: background-color 0.3s ease;
      width: 50%;
      min-height: 10vw;
      max-width: 300px;
    }

    button:hover {
      background-color: #0056b3;
    }

    button.hidden {
      display: none;
    }

    .button-container {
      text-align: center;
      margin-top: 1.5;
    }

    .button-container button {
      margin-bottom: 1em;
      /* Add spacing between buttons */
    }

    @media (max-width: 768px) {
      body {
        padding: 0.5rem;
        /* Reduce padding for smaller screens */
      }

      h2 {
        font-size: 1.25rem;
        /* Reduce font size for smaller screens */
      }

      .question {
        padding: 0.75em;
        /* Reduce padding for smaller screens */
        margin-bottom: 1em;
        /* Reduce spacing between questions */
      }

      label {
        font-size: 0.9rem;
        /* Adjust font size for smaller screens */
      }

      input[type="radio"] {
        width: 18px;
        /* Slightly smaller radio buttons */
        height: 18px;
      }

      button {
        font-size: 0.9rem;
        /* Adjust button font size */
        padding: 0.5em 1em;
        /* Adjust button padding */
      }
    }

    @media (max-width: 480px) {
      h2 {
        font-size: 1rem;
        /* Further reduce font size for very small screens */
      }

      .question {
        padding: 0.5em;
        /* Further reduce padding */
      }

      label {
        font-size: 0.85rem;
        /* Further reduce font size */
      }

      button {
        font-size: 0.8rem;
        /* Further adjust button font size */
        padding: 0.5em;
        /* Further adjust button padding */
      }
    }
  </style>
</head>

<body>
  <h2>Problem Solving Inventory (PSI) - Self Assessment</h2>
  <form id="psiForm">
    <!-- Questions will be inserted here by JavaScript -->
  </form>
  <div class="button-container">
    <button id="backButton" class="hidden" onclick="showPreviousQuestions()">Back</button>
    <button id="nextButton" onclick="showNextQuestions()">Next</button>
    <button id="submitButton" class="hidden" onclick="submitForm()">Submit</button>
  </div>

  <script type="module">
    import QuestionaireDataManager from "../scripts/QuestionaireDataManager.js";
    const questions = [
      "When a solution to a problem has failed, I do not examine why it didn’t work.",
      "When I am confronted with a complex problem, I don’t take the time to develop a strategy for collecting information that will help define the nature of the problem.",
      "When my first efforts to solve a problem fail, I become uneasy about my ability to handle the situation.",
      "After I solve a problem, I do not analyze what went right and what went wrong.",
      "I am usually able to think of creative and effective alternatives to my problems.",
      "After following a course of action to solve a problem, I compare the actual outcome with the one I had anticipated.",
      "When I have a problem, I think of as many possible ways to handle it as I can until I can’t come up with any more ideas.",
      "When confronted with a problem, I consistently examine my feelings to find out what is going on in a problem situation.",
      "When confused about a problem, I don’t clarify vague ideas or feeling by thinking of them in concrete terms.",
      "I have the ability to solve most problems even though initially no solution is immediately apparent.",
      "Many of the problems I face are too complex for me to solve.",
      "When solving a problem, I make decisions that I am happy with later.",
      "When confronted with a problem, I tend to do the first thing that I can think of to solve it.",
      "Sometimes I do not stop and take time to deal with my problems, but just kind of muddle ahead.",
      "When considering solutions to a problem, I do not take the time to assess the potential success of each alternative.",
      "When confronted with a problem, I stop and think about it before deciding on a next step.",
      "I generally act on the first idea that comes to mind in solving a problem.",
      "When making a decision, I compare alternatives and weigh the consequences of one against the other.",
      "When I make plans to solve a problem, I am almost certain that I can make them work.",
      "I try to predict the result of a particular course of action.",
      "When I try to think of possible solutions to a problem, I do not come up with very many alternatives.",
      "When trying to solve a problem, one strategy I often use is to think of past problems that have been similar.",
      "Given enough time and effort, I believe I can solve most problems that confront me.",
      "When faced with a novel situation, I have confidence that I can handle problems that may arise.",
      "Even though I work on a problem, sometimes I feel like I’m groping or wandering and not getting down to the real issue.",
      "I make snap judgements and later regret them.",
      "I trust my ability to solve new and difficult problems.",
      "I use a systematic method to compare alternatives and make decisions.",
      "When thinking of ways to handle a problem, I seldom combine ideas from various alternatives to arrive at a workable solution.",
      "When faced with a problem, I seldom assess the external forces that may be contributing to the problem.",
      "When confronted with a problem, I usually first survey the situation to determine the relevant information.",
      "There are times when I become so emotionally charged that I can no longer see the alternatives for solving a particular problem.",
      "After making a decision, the actual outcome is usually similar to what I had anticipated.",
      "When confronted with a problem, I am unsure of whether I can handle the situation.",
      "When I become aware of a problem, one of the first things I do is try to find out exactly what the problem is."
    ];

    const subscales = [
      "AAS", "AAS", "PSC", "AAS", "PC", "PC", "PC", "PC", "Unbekannt", "PSC",
      "PC", "PSC", "AAS", "AAS", "AAS", "PC", "AAS", "PC", "PSC", "PC",
      "PC", "PC", "PSC", "PSC", "AAS", "AAS", "PSC", "PC", "PC", "PC",
      "PC", "PC", "PSC", "PSC", "PC"
    ];

    const scaleLabels = [
      "1 - Strongly Agree",
      "2 - Moderately Agree",
      "3 - Slightly Agree",
      "4 - Slightly Disagree",
      "5 - Moderately Disagree",
      "6 - Strongly Disagree"
    ];

    const form = document.getElementById("psiForm");
    const questionaireDataManager = new QuestionaireDataManager(); // Create an instance of QuestionaireDataManager
    questionaireDataManager.setType("PSI - Problem Solving Inventory"); // Set the type of the questionnaire

    let currentQuestionIndex = 0; // Tracks the current set of questions
    const questionsPerPage = 5; // Number of questions to show per page
    const userAnswers = {}; // Object to store user answers

    // Function to render a set of questions
    function renderQuestions(startIndex) {
      form.innerHTML = ""; // Clear the form
      const endIndex = Math.min(startIndex + questionsPerPage, questions.length);

      for (let i = startIndex; i < endIndex; i++) {
        const div = document.createElement("div");
        div.className = "question";

        const label = document.createElement("label");
        label.textContent = `${i + 1}. [${subscales[i]}] ${questions[i]}`;
        div.appendChild(label);

        // Create a container for the scale options
        const scaleOptions = document.createElement("div");
        scaleOptions.className = "scale-options";

        scaleLabels.forEach((scaleText, value) => {
          const optionDiv = document.createElement("div");
          optionDiv.className = "scale-option";

          const radio = document.createElement("input");
          radio.type = "radio";
          radio.name = `q${i + 1}`;
          radio.id = `q${i + 1}_option${value + 1}`; // Unique ID for each radio button
          radio.value = value + 1;
          radio.required = true;

          // Pre-fill the radio button if the user has already answered this question
          if (userAnswers[`q${i + 1}`] === String(value + 1)) {
            radio.checked = true;
          }
          const label = document.createElement("label");
          label.textContent = scaleText;
          label.setAttribute("for", radio.id); // Associate the label with the radio button

          optionDiv.appendChild(radio);
          optionDiv.appendChild(label);
          scaleOptions.appendChild(optionDiv);
        });

        div.appendChild(scaleOptions);
        form.appendChild(div);
      }
    }

    // Show the first set of questions
    renderQuestions(currentQuestionIndex);

    function allAnswersValid() {
      const data = new FormData(form);
      // Validate that all questions on the current page are answered and store the answers
      for (let i = currentQuestionIndex; i < currentQuestionIndex + questionsPerPage; i++) {
        if (i >= questions.length) break;
        const answer = data.get(`q${i + 1}`);
        if (!answer) {
          return false;
        } else {

        }
      }
      return true;
    }

    function saveAnswers() {
      const data = new FormData(form);
      for (let i = currentQuestionIndex; i < currentQuestionIndex + questionsPerPage; i++) {
        if (i >= questions.length) break;
        const answer = data.get(`q${i + 1}`);
        if (answer) {
          userAnswers[`q${i + 1}`] = answer; // Save the answer
        }
      }
    }

    // Function to show the previous set of questions
    window.showPreviousQuestions = function () {
      saveAnswers(); // Save the answers before moving to the previous set
      // Move to the previous set of questions
      currentQuestionIndex -= questionsPerPage;

      // Ensure the index doesn't go below 0
      if (currentQuestionIndex < 0) {
        currentQuestionIndex = 0;
      }

      // Render the previous set of questions
      renderQuestions(currentQuestionIndex);

      // Update button visibility
      if (currentQuestionIndex === 0) {
        document.getElementById("backButton").classList.add("hidden"); // Hide "Back" button on the first set
      }
      document.getElementById("nextButton").classList.remove("hidden"); // Show "Next" button
      document.getElementById("submitButton").classList.add("hidden"); // Hide "Submit" button
    };



    // Function to show the next set of questions
    window.showNextQuestions = function () {
      const data = new FormData(form);

      if (!allAnswersValid()) {
        alert("Please answer all questions before proceeding.");
        return;
      }
      saveAnswers(); // Save the answers before moving to the next set
      // Move to the next set of questions
      currentQuestionIndex += questionsPerPage;

      if (currentQuestionIndex >= questions.length - questionsPerPage) {
        // Render the last set of questions
        renderQuestions(currentQuestionIndex);
        // If no more questions, show the submit button and hide the next button
        document.getElementById("nextButton").classList.add("hidden");
        document.getElementById("submitButton").classList.remove("hidden");
      } else {
        // Render the next set of questions
        renderQuestions(currentQuestionIndex);
      }

      // Show the "Back" button after the first set
      if (currentQuestionIndex > 0) {
        document.getElementById("backButton").classList.remove("hidden");
      }
    };

    // Function to submit the form
    window.submitForm = function () {
      if (!allAnswersValid()) {
        alert("Please answer all questions before proceeding.");
        return;
      }
      saveAnswers(); // Save the answers before moving to the next set
      // Iterate over the userAnswers object
      for (const [questionKey, answer] of Object.entries(userAnswers)) {
        // Extract the question index from the key (e.g., "q1" -> 1)
        const questionIndex = parseInt(questionKey.slice(1), 10) - 1;

        // Add data to QuestionaireDataManager
        questionaireDataManager.addQuestionaireData(
          parseInt(answer, 10), // Add answer as a number
          subscales[questionIndex], // Add subscale name
          questionIndex + 1 // Add question index (1-based)
        );
      }
      // Save and log the results
      questionaireDataManager.save();
      console.log("Questionnaire Data:", questionaireDataManager.getData());
      alert("Thank you! Your responses have been recorded.");
      window.location.href = '../end.html'; // Redirect to the end page
    };
  </script>
</body>

</html>